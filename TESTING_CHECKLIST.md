# 图片理解功能测试清单

## 前端测试

### 1. 图片上传功能
- [ ] 点击附件按钮能够打开文件选择对话框
- [ ] 能够选择并上传单张图片
- [ ] 能够选择并上传多张图片
- [ ] 上传的图片在输入框上方正确显示预览
- [ ] 图片预览区域显示正确的文件名
- [ ] 支持的图片格式（PNG, JPG, JPEG, GIF, WebP, BMP）都能正常上传

### 2. 图片管理功能
- [ ] 点击图片预览的删除按钮能够移除图片
- [ ] 删除图片后 attachment 状态正确更新
- [ ] 点击图片预览能够放大查看图片
- [ ] 多张图片的顺序保持正确

### 3. 消息发送功能
- [ ] 只上传图片不输入文字可以发送
- [ ] 同时上传图片和输入文字可以发送
- [ ] 发送后图片预览区域被清空
- [ ] 发送后 fileList 和 attachment 状态被正确重置

### 4. 类型转换
- [ ] 上传的图片正确转换为 Base64 格式
- [ ] ImageBlock 包含正确的 type 字段 ("image")
- [ ] ImageBlock 包含正确的 source.type 字段 ("base64")
- [ ] ImageBlock 包含正确的 source.media_type 字段
- [ ] ImageBlock 包含正确的 source.data 字段（Base64 字符串）

## 后端测试

### 1. 格式转换功能
- [ ] ImageConverter 能够正确解析前端发送的 ContentBlocks
- [ ] Base64 数据能够正确解码
- [ ] 临时文件能够成功创建
- [ ] 临时文件路径正确
- [ ] 转换后的 ImageBlock 包含 url 字段
- [ ] 支持同时处理多个 ImageBlock

### 2. 文件管理
- [ ] 临时文件保存在正确的目录
- [ ] 临时文件命名唯一（使用 UUID）
- [ ] 临时文件扩展名与图片类型匹配
- [ ] cleanup() 方法能够删除所有临时文件
- [ ] 异常情况下临时文件也能被清理（try-finally）

### 3. 消息处理
- [ ] query 参数能够正确解析为 JSON
- [ ] 文本内容正确传递给 agent
- [ ] 图片内容正确传递给 agent
- [ ] 混合内容（文本+图片）正确传递给 agent

## 集成测试

### 1. 端到端流程
- [ ] 前端上传图片 → 后端接收 → 模型处理 → 返回结果
- [ ] 整个流程没有报错
- [ ] 响应时间在合理范围内
- [ ] 返回的答案与图片内容相关

### 2. 不同模型测试
- [ ] DashScope (qwen-vl-max) 能正确处理图片
- [ ] OpenAI (gpt-4o) 能正确处理图片
- [ ] Anthropic (claude-3-opus) 能正确处理图片
- [ ] Gemini 能正确处理图片
- [ ] Ollama (llava) 能正确处理图片

### 3. 错误处理
- [ ] 上传非图片文件时显示错误提示
- [ ] 图片过大时显示错误提示
- [ ] Base64 转换失败时显示错误提示
- [ ] 模型 API 调用失败时显示错误提示
- [ ] 网络错误时显示错误提示

## 性能测试

### 1. 图片大小测试
- [ ] 100KB 图片处理正常
- [ ] 1MB 图片处理正常
- [ ] 5MB 图片处理正常
- [ ] 10MB 图片处理正常
- [ ] 20MB 图片处理正常（边界测试）

### 2. 多图片测试
- [ ] 1 张图片处理正常
- [ ] 3 张图片处理正常
- [ ] 5 张图片处理正常
- [ ] 10 张图片处理正常

### 3. 内存和存储
- [ ] 临时文件在对话结束后被删除
- [ ] 多次对话不会导致临时文件累积
- [ ] 内存使用在合理范围内

## 用户体验测试

### 1. UI/UX
- [ ] 图片上传按钮易于发现
- [ ] 上传进度有适当的视觉反馈
- [ ] 图片预览清晰可见
- [ ] 删除图片的交互直观
- [ ] 错误消息清晰易懂

### 2. 响应时间
- [ ] 图片上传响应及时（< 1秒）
- [ ] Base64 转换不阻塞 UI
- [ ] 模型响应时间在可接受范围内（取决于模型）

## 安全性测试

### 1. 输入验证
- [ ] 只接受图片文件格式
- [ ] 拒绝过大的文件
- [ ] 正确处理恶意文件名
- [ ] 正确处理损坏的图片文件

### 2. 数据安全
- [ ] 临时文件只有当前用户可读写
- [ ] Base64 数据不会泄露到日志
- [ ] API 密钥不会暴露

## 兼容性测试

### 1. 浏览器兼容性
- [ ] Chrome 测试通过
- [ ] Firefox 测试通过
- [ ] Safari 测试通过
- [ ] Edge 测试通过

### 2. 操作系统兼容性
- [ ] Windows 测试通过
- [ ] macOS 测试通过
- [ ] Linux 测试通过

## 回归测试

### 1. 现有功能
- [ ] 纯文本对话功能正常
- [ ] 历史记录功能正常
- [ ] 设置页面功能正常
- [ ] 其他非 Friday 功能正常

### 2. 向后兼容
- [ ] 旧的配置文件仍然可用
- [ ] 未配置多模态模型时纯文本对话正常

## 测试结果记录

### 测试环境
- 测试日期：____________
- 测试人员：____________
- 前端版本：____________
- 后端版本：____________
- Python 版本：____________
- Node.js 版本：____________

### 发现的问题
1.
2.
3.

### 改进建议
1.
2.
3.

---

**测试完成后，请确保所有核心功能项都已勾选通过！**
